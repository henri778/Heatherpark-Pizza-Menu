<img src="images/heatherpark-logo.png" alt="Heatherpark Superspar" class="brand-logo">

      <div class="header-wrap">
        <h1>Heatherpark Pizza Order</h1>
<p>Send to WhatsApp <span style="color:#fff;font-weight:bold;">066 208 1559</span></p>

        <div class="grid">
        <div class="left" id="leftPanel">
          <label class="label">Name</label>
          <input id="name" class="field" placeholder="Your name">

          <label class="label">Cell number</label>
          <input id="cell" class="field" placeholder="0821234567" inputmode="tel">

          <label class="label">Pickup time</label>
          <input id="pickup" type="time" class="field" value="18:30">

          <div style="margin-top:12px">
            <label class="label">Pizza Menu</label>
            <div id="menuList" class="menu-list"></div>
          </div>

          <label class="label" style="margin-top:12px">Comments / Notes</label>
          <textarea id="comments" rows="3" placeholder="E.g. cut into 8 slices"></textarea>
        </div>

        <div class="right">
          <div class="summary" id="summaryBox">
            <div style="text-align:center;font-weight:800;margin-bottom:6px">Order Summary</div>
            <div class="summary-row"><div class="small">Selected pizzas</div><div id="selectedCount">0</div></div>
            <div class="summary-row"><div class="small">Pizzas total</div><div id="pizzasTotal">R0</div></div>
            <div class="summary-row"><div class="small">Extras total</div><div id="extrasTotal">R0</div></div>
            <div class="summary-row"><div class="small">Savings</div><div id="savingAmount">R0</div></div>
            <div class="summary-row" style="font-weight:800"><div class="small">Total to pay</div><div class="totalbig" id="totalPrice">R0</div></div>
            <div id="specialBadge" style="display:none;text-align:center;margin-top:8px;color:#a3f;font-weight:800"></div>
            <div style="margin-top:8px;font-weight:700">Per-pizza extras</div>
            <div id="perPizzaToppings" style="color:var(--muted);margin-top:6px">None</div>
          </div>

          <div class="controls">
            <button class="btn" id="previewBtn">Preview</button>
            <button class="btn" id="sendBtn">Send to WhatsApp</button>
            <button class="btn secondary" id="clearBtn">Clear</button>
          </div>

          <div class="preview" id="previewArea" style="display:none"></div>
          <div class="small" style="margin-top:12px">Tuesday special: if a customer selects exactly 2 pizzas, the pizzas' combined price becomes R130 (extras charged on top).</div>
        </div>
      </div>

      <div class="footer">Heatherpark Superspar — (044) 870-0911</div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const SHOP_LOCAL = "0662081559";
  const SHOP_WA = "27" + SHOP_LOCAL.replace(/^0/, "");
  const isTuesday = (new Date()).getDay() === 2;

  const MENU = [
    {id:'focaccia',name:"Focaccia",desc:"Italian Herbs & Garlic",price:55},
    {id:'margherita',name:"Margherita",desc:"Cheese & Tomato",price:60},
    {id:'regina',name:"Regina",desc:"Ham & Mushroom",price:80},
    {id:'hawaiian',name:"Hawaiian",desc:"Ham & Pineapple",price:80},
    {id:'bacon',name:"Bacon",desc:"Bacon & Feta",price:85},
    {id:'chicken',name:"Chicken",desc:"BBQ Chicken & Mushroom",price:85},
    {id:'mexican',name:"Mexican",desc:"Spicy mince, Sweet peppers, Onions & Chilli",price:90},
    {id:'pepperoni',name:"Pepperoni",desc:"Italian Salami",price:80},
    {id:'vegetarian',name:"Vegetarian",desc:"Mushrooms, Peppers & Olives",price:80}
  ];
  const EXTRAS = [
    {id:'garlic',name:"Garlic",price:15},
    {id:'peppers',name:"Peppers",price:15},
    {id:'mushroom',name:"Mushroom",price:15},
    {id:'pineapple',name:"Pineapple",price:15},
    {id:'onion',name:"Onion",price:15},
    {id:'spinach',name:"Spinach",price:15},
    {id:'ham',name:"Ham",price:20},
    {id:'bacon',name:"Bacon",price:20},
    {id:'salami',name:"Salami",price:20},
    {id:'mince',name:"Mince",price:20},
    {id:'chicken',name:"Chicken",price:20},
    {id:'avo',name:"Avo",price:25}
  ];

  const menuList = document.getElementById('menuList');
  const perPizzaToppings = document.getElementById('perPizzaToppings');
  const specialBadge = document.getElementById('specialBadge');

  let pizzaInstances = [];

  function renderMenu(){
    menuList.innerHTML = '';
    MENU.forEach(it => {
      const row = document.createElement('div'); row.className='menu-item';
      const left = document.createElement('div'); left.className='leftpart';
      const nameWrap = document.createElement('div'); nameWrap.style.minWidth='0';
      const pname = document.createElement('div'); pname.className='pname'; pname.textContent = it.name;
      const pdesc = document.createElement('div'); pdesc.className='pdesc'; pdesc.textContent = it.desc;
      nameWrap.appendChild(pname); nameWrap.appendChild(pdesc);
      left.appendChild(nameWrap);

      const right = document.createElement('div'); right.className='rightpart';
      const qtybox = document.createElement('div'); qtybox.className='qtybox';
      const minus = document.createElement('button'); minus.type='button'; minus.textContent='−';
      const qinput = document.createElement('input'); qinput.type='number'; qinput.min='0'; qinput.value='0';
      const plus = document.createElement('button'); plus.type='button'; plus.textContent='+';
      qtybox.appendChild(minus); qtybox.appendChild(qinput); qtybox.appendChild(plus);

      const addbtn = document.createElement('button'); addbtn.className='addextras'; addbtn.textContent='Add extras';
      const price = document.createElement('div'); price.className='price'; price.textContent = 'R' + it.price;

      right.appendChild(qtybox); right.appendChild(addbtn); right.appendChild(price);
      row.appendChild(left); row.appendChild(right);
      menuList.appendChild(row);

      plus.addEventListener('click', (e)=>{ e.stopPropagation(); qinput.value = Number(qinput.value)+1; syncInstances(it, Number(qinput.value), addbtn); });
      minus.addEventListener('click', (e)=>{ e.stopPropagation(); qinput.value = Math.max(0, Number(qinput.value)-1); syncInstances(it, Number(qinput.value), addbtn); });
      qinput.addEventListener('change', ()=>{ let v=Number(qinput.value)||0; if(v<0)v=0; qinput.value=v; syncInstances(it, v, addbtn); });

      row.addEventListener('click', (e)=>{ if(['input','button'].includes(e.target.tagName.toLowerCase())) return; qinput.value = Number(qinput.value)+1; syncInstances(it, Number(qinput.value), addbtn); });

      addbtn.addEventListener('click', (e)=>{ e.stopPropagation(); openExtrasPanel(it); });
    });
  }

  function syncInstances(menuItem, desiredQty, addbtn){
    while(pizzaInstances.filter(p=>p.menuId===menuItem.id).length < desiredQty){
      const instId = Date.now().toString(36) + Math.floor(Math.random()*100).toString(36);
      pizzaInstances.push({instId, menuId:menuItem.id, name:menuItem.name, price:menuItem.price, toppings:[]});
    }
    while(pizzaInstances.filter(p=>p.menuId===menuItem.id).length > desiredQty){
      for(let i=pizzaInstances.length-1;i>=0;i--){ if(pizzaInstances[i].menuId===menuItem.id){ pizzaInstances.splice(i,1); break; } }
    }
    if(desiredQty>0) addbtn.style.display='inline-block'; else addbtn.style.display='none';
    if(desiredQty===0) document.querySelectorAll('.toppings-panel').forEach(n=>n.remove());
    updateTotals();
  }

  function openExtrasPanel(menuItem){
    const instances = pizzaInstances.filter(p=>p.menuId===menuItem.id);
    if(instances.length===0){ alert('Please add this pizza first (use +) then add extras.'); return; }
    document.querySelectorAll('.toppings-panel').forEach(n=>n.remove());
    const menuRows = Array.from(menuList.children);
    let targetRow = null;
    for(const r of menuRows){ const name = r.querySelector('.pname'); if(name && name.textContent===menuItem.name){ targetRow=r; break; } }
    if(!targetRow) return;

    const panel = document.createElement('div'); panel.className='toppings-panel';
    const heading = document.createElement('div'); heading.className='pname'; heading.textContent = 'Add extras for ' + menuItem.name;
    panel.appendChild(heading);

    instances.forEach((inst, idx)=>{
      const instWrap = document.createElement('div'); instWrap.style.borderTop='1px solid rgba(255,255,255,0.03)'; instWrap.style.paddingTop='8px';
      const title = document.createElement('div'); title.style.fontWeight='700'; title.textContent = inst.name + ' (' + (idx+1) + ')';
      instWrap.appendChild(title);
      const row = document.createElement('div'); row.className='toppings-row';
      EXTRAS.forEach(ex=>{
        const chip = document.createElement('div'); chip.className='topping-item';
        const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = inst.toppings.includes(ex.id); cb.dataset.ex=ex.id;
        const label = document.createElement('div'); label.className='topping-title'; label.textContent = ex.name + ' — R' + ex.price;
        chip.appendChild(cb); chip.appendChild(label);
        chip.addEventListener('click',(e)=>{ if(e.target.tagName.toLowerCase()==='input') return; cb.checked=!cb.checked; toggleInst(inst.instId, ex.id, cb.checked); });
        cb.addEventListener('change', ()=> toggleInst(inst.instId, ex.id, cb.checked));
        row.appendChild(chip);
      });
      instWrap.appendChild(row);
      panel.appendChild(instWrap);
    });

    targetRow.insertAdjacentElement('afterend', panel);
    panel.style.display='flex';
  }

  function toggleInst(instId, exId, checked){
    const inst = pizzaInstances.find(p=>p.instId===instId);
    if(!inst) return;
    if(checked){ if(!inst.toppings.includes(exId)) inst.toppings.push(exId); } else { inst.toppings = inst.toppings.filter(t=>t!==exId); }
    updateTotals();
  }

  renderMenu();

  function updateTotals(){
    const pizzaSum = pizzaInstances.reduce((s,p)=>s + Number(p.price), 0);
    const pizzaCount = pizzaInstances.length;
    let extrasSum = 0;
    pizzaInstances.forEach(p=>{ p.toppings.forEach(tid=>{ const ex = EXTRAS.find(x=>x.id===tid); if(ex) extrasSum += Number(ex.price); }); });
    const original = pizzaSum + extrasSum;
    let saving = 0;
    let finalTotal = original;
    if(isTuesday && pizzaCount===2){ if(pizzaSum > 130) saving = pizzaSum - 130; finalTotal = 130 + extrasSum; }
    document.getElementById('selectedCount').innerText = pizzaCount;
    document.getElementById('pizzasTotal').innerText = 'R' + pizzaSum;
    document.getElementById('extrasTotal').innerText = 'R' + extrasSum;
    document.getElementById('savingAmount').innerText = (saving>0? 'R'+saving : 'R0');
    document.getElementById('totalPrice').innerText = 'R' + finalTotal;
    if(isTuesday && pizzaCount===2 && saving>0){ specialBadge.style.display='block'; specialBadge.textContent='TUESDAY SPECIAL APPLIED — 2 PIZZAS FOR R130'; } else { specialBadge.style.display='none'; specialBadge.textContent=''; }
    if(pizzaInstances.length===0) perPizzaToppings.textContent='None'; else {
      perPizzaToppings.innerHTML=''; pizzaInstances.forEach((p,i)=>{ const div=document.createElement('div'); const names = p.toppings.map(tid=>{ const f=EXTRAS.find(x=>x.id===tid); return f? f.name + ' (R'+f.price+')':tid; }); div.textContent = `${p.name} (${i+1}): ` + (names.length? names.join(', '): 'No extras'); perPizzaToppings.appendChild(div); });
    }
  }

  function gatherOrder(){
    const name = document.getElementById('name').value.trim();
    const cell = document.getElementById('cell').value.trim();
    const pickup = document.getElementById('pickup').value;
    const comments = document.getElementById('comments').value.trim();
    const pizzas = pizzaInstances.map((p,i)=> p.name + ' (' + (i+1) + ')' );
    const pizzaSum = pizzaInstances.reduce((s,p)=>s + Number(p.price), 0);
    let extrasSum = 0;
    pizzaInstances.forEach(p=>{ p.toppings.forEach(tid=>{ const ex = EXTRAS.find(x=>x.id===tid); if(ex) extrasSum += Number(ex.price); }); });
    const original = pizzaSum + extrasSum;
    let saving = 0; let finalTotal = original;
    if(isTuesday && pizzaInstances.length===2){ if(pizzaSum > 130) saving = pizzaSum - 130; finalTotal = 130 + extrasSum; }
    const perPizza = pizzaInstances.map((p,i)=>{ const names = p.toppings.map(tid=>{ const f=EXTRAS.find(x=>x.id===tid); return f? f.name + ' (R'+f.price+')' : tid; }); return `${p.name} (${i+1}): ${names.length? names.join(', '): 'No extras'}`; });
    return {name,cell,pickup,comments,pizzas,original,finalTotal,saving,isTuesday,perPizza};
  }

  function formatMessage(order){
    const lines = [];
    lines.push('Heatherpark Superspar - Pizza Order');
    lines.push('-------------------------------');
    if(order.name) lines.push('Name: ' + order.name);
    if(order.cell) lines.push('Cell: ' + order.cell);
    if(order.pickup) lines.push('Pickup: ' + order.pickup);
    lines.push('Pizzas: ' + (order.pizzas.length? order.pizzas.join(' + '): '(none)'));
    if(order.perPizza && order.perPizza.length){ lines.push('Per-pizza extras:'); order.perPizza.forEach(p=> lines.push(' - ' + p)); }
    if(order.comments) lines.push('Comments: ' + order.comments);
    lines.push('Original total: R' + order.original);
    if(order.isTuesday && order.pizzas.length===2 && order.saving>0){
      lines.push('TUESDAY SPECIAL applied: 2 pizzas for R130');
      lines.push('You saved: R' + order.saving);
      lines.push('Total to pay: R' + order.finalTotal);
    } else {
      lines.push('Total to pay: R' + order.finalTotal);
    }
    lines.push('-------------------------------');
    return lines.join("\\n");
  }

  document.getElementById('previewBtn').addEventListener('click', ()=>{
    const order = gatherOrder(); const msg = formatMessage(order);
    const pa = document.getElementById('previewArea'); pa.style.display='block'; pa.textContent = msg;
  });

  document.getElementById('sendBtn').addEventListener('click', ()=>{
    const order = gatherOrder();
    if(!order.name){ alert('Please enter your name'); return; }
    if(!order.cell){ alert('Please enter a cell number'); return; }
    if(order.pizzas.length===0){ if(!confirm('No pizzas selected. Send anyway?')) return; }
    let confirmMsg = 'You will pay R' + order.finalTotal;
    if(order.isTuesday && order.pizzas.length===2 && order.saving>0){ confirmMsg += ' (Tuesday special applied — you save R' + order.saving + ')'; }
    confirmMsg += '. Send order to WhatsApp?';
    if(!confirm(confirmMsg)) return;
    const text = formatMessage(order); const encoded = encodeURIComponent(text);
    const wa = 'https://wa.me/' + SHOP_WA + '?text=' + encoded;
    window.open(wa, '_blank');
  });

  document.getElementById('clearBtn').addEventListener('click', ()=>{
    document.querySelectorAll('.qtybox input').forEach(i=> i.value='0');
    pizzaInstances = [];
    document.getElementById('name').value=''; document.getElementById('cell').value=''; document.getElementById('pickup').value='18:30'; document.getElementById('comments').value='';
    document.querySelectorAll('.toppings-panel').forEach(n=>n.remove());
    updateTotals();
    document.getElementById('previewArea').style.display='none';
  });

}); // DOMContentLoaded
</script>

</body>
</html>
